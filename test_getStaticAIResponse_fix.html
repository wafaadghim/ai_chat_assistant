<!DOCTYPE html>
<html>
<head>
    <title>Test JavaScript Fix - window.getStaticAIResponse</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .code-block { background-color: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
        #testOutput { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Test JavaScript - Correction window.getStaticAIResponse</h1>
    
    <div class="test-result success">
        <h2>ğŸ¯ Objectif</h2>
        <p>Tester que la fonction <code>window.getStaticAIResponse</code> fonctionne sans erreur <code>ReferenceError: responses is not defined</code></p>
    </div>

    <div class="test-result">
        <h2>ğŸ§ª Tests Automatiques</h2>
        <button onclick="runAllTests()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            ExÃ©cuter Tous les Tests
        </button>
        <div id="testOutput"></div>
    </div>

    <script>
        // Fonction de dÃ©tection de langue (simulation)
        window.detectMessageLanguage = function(message) {
            if (/[\u0600-\u06FF]/.test(message)) return 'ar';
            if (/\b(bonjour|salut|comment|Ã§a|franÃ§ais)\b/i.test(message)) return 'fr';
            return 'en';
        };

        // Fonction corrigÃ©e avec responses dÃ©finie localement
        window.getStaticAIResponse = function(message) {
            const msg = message.toLowerCase();
            const language = window.detectMessageLanguage(message);
            
            // âœ… CORRECTION: DÃ©finir les rÃ©ponses localement
            const responses = {
                'fr': {
                    'greeting': 'ğŸ‘‹ Bonjour ! Je suis votre assistant IA marketing. Comment puis-je vous aider ?',
                    'overview': 'ğŸ“Š AperÃ§u marketing : Vos campagnes performent bien avec un taux d\'ouverture moyen de 22%.',
                    'performance': 'ğŸ“ˆ Performance : Vos derniÃ¨res campagnes montrent une amÃ©lioration de 15% par rapport au mois dernier.',
                    'default': 'ğŸ¤– Je comprends votre question. Veuillez reformuler pour une rÃ©ponse plus prÃ©cise.'
                },
                'en': {
                    'greeting': 'ğŸ‘‹ Hello! I\'m your AI marketing assistant. How can I help you?',
                    'overview': 'ğŸ“Š Marketing overview: Your campaigns are performing well with an average open rate of 22%.',
                    'performance': 'ğŸ“ˆ Performance: Your latest campaigns show a 15% improvement compared to last month.',
                    'default': 'ğŸ¤– I understand your question. Please rephrase for a more accurate response.'
                },
                'ar': {
                    'greeting': 'ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ù„Ù„ØªØ³ÙˆÙŠÙ‚ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ',
                    'overview': 'ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ³ÙˆÙŠÙ‚: Ø­Ù…Ù„Ø§ØªÙƒ ØªØ¤Ø¯ÙŠ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯ Ø¨Ù…Ø¹Ø¯Ù„ ÙØªØ­ Ù…ØªÙˆØ³Ø· 22%.',
                    'performance': 'ğŸ“ˆ Ø§Ù„Ø£Ø¯Ø§Ø¡: Ø­Ù…Ù„Ø§ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØªØ¸Ù‡Ø± ØªØ­Ø³Ù†Ø§ Ø¨Ù†Ø³Ø¨Ø© 15% Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ.',
                    'default': 'ğŸ¤– Ø£ÙÙ‡Ù… Ø³Ø¤Ø§Ù„Ùƒ. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©.'
                }
            };
            
            const lang = responses[language] || responses['en'];
            
            if (msg.includes('hello') || msg.includes('hi') || msg.includes('bonjour') || msg.includes('salut') || msg.includes('Ù…Ø±Ø­Ø¨Ø§') || msg.includes('Ø§Ù„Ø³Ù„Ø§Ù…')) {
                return lang.greeting;
            }
            
            if (msg.includes('aperÃ§u') || msg.includes('overview') || msg.includes('Ù†Ø¸Ø±Ø©')) {
                return lang.overview;
            }
            
            if (msg.includes('performance') || msg.includes('campagne') || msg.includes('campaign') || msg.includes('Ø£Ø¯Ø§Ø¡') || msg.includes('Ø­Ù…Ù„Ø©')) {
                return lang.performance;
            }
            
            return lang.default;
        };

        // Fonction de test
        function runTest(testName, testFunction) {
            const output = document.getElementById('testOutput');
            try {
                const result = testFunction();
                output.innerHTML += `<div style="color: green;">âœ… ${testName}: RÃ‰USSI</div>`;
                if (result) {
                    output.innerHTML += `<div style="margin-left: 20px; color: #666;">RÃ©sultat: ${result}</div>`;
                }
                return true;
            } catch (error) {
                output.innerHTML += `<div style="color: red;">âŒ ${testName}: Ã‰CHEC - ${error.message}</div>`;
                return false;
            }
        }

        function runAllTests() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<h3>ğŸ” ExÃ©cution des tests...</h3>';
            
            let totalTests = 0;
            let passedTests = 0;

            // Test 1: Salutation franÃ§aise
            totalTests++;
            if (runTest('Test salutation franÃ§aise', () => {
                return window.getStaticAIResponse('Bonjour !');
            })) passedTests++;

            // Test 2: Salutation anglaise
            totalTests++;
            if (runTest('Test salutation anglaise', () => {
                return window.getStaticAIResponse('Hello there!');
            })) passedTests++;

            // Test 3: Salutation arabe
            totalTests++;
            if (runTest('Test salutation arabe', () => {
                return window.getStaticAIResponse('Ù…Ø±Ø­Ø¨Ø§');
            })) passedTests++;

            // Test 4: Question performance
            totalTests++;
            if (runTest('Test question performance', () => {
                return window.getStaticAIResponse('What is my campaign performance?');
            })) passedTests++;

            // Test 5: Question overview
            totalTests++;
            if (runTest('Test question overview', () => {
                return window.getStaticAIResponse('Montre-moi l\'aperÃ§u marketing');
            })) passedTests++;

            // Test 6: Question par dÃ©faut
            totalTests++;
            if (runTest('Test question par dÃ©faut', () => {
                return window.getStaticAIResponse('Question quelconque sans mots-clÃ©s');
            })) passedTests++;

            // Test 7: VÃ©rifier que responses n'est pas global
            totalTests++;
            if (runTest('Test absence de variable globale responses', () => {
                if (typeof responses !== 'undefined') {
                    throw new Error('Variable globale responses dÃ©tectÃ©e (problÃ¨me)');
                }
                return 'Variable responses correctement encapsulÃ©e';
            })) passedTests++;

            // RÃ©sultat final
            output.innerHTML += `<h3 style="margin-top: 20px;">ğŸ“Š RÃ©sultats des Tests</h3>`;
            output.innerHTML += `<div style="font-weight: bold; font-size: 18px;">`;
            output.innerHTML += `${passedTests}/${totalTests} tests rÃ©ussis`;
            output.innerHTML += `</div>`;
            
            if (passedTests === totalTests) {
                output.innerHTML += `<div style="color: green; font-weight: bold; margin-top: 10px;">`;
                output.innerHTML += `ğŸ‰ TOUS LES TESTS RÃ‰USSIS ! La correction fonctionne parfaitement.`;
                output.innerHTML += `</div>`;
            } else {
                output.innerHTML += `<div style="color: red; font-weight: bold; margin-top: 10px;">`;
                output.innerHTML += `âŒ ${totalTests - passedTests} test(s) ont Ã©chouÃ©.`;
                output.innerHTML += `</div>`;
            }
        }

        // Auto-exÃ©cution au chargement
        window.addEventListener('load', function() {
            console.log('ğŸ§ª Page de test JavaScript chargÃ©e');
            console.log('âœ… Fonction window.getStaticAIResponse dÃ©finie');
            console.log('ğŸ”§ PrÃªt pour les tests');
        });
    </script>

    <div class="test-result success">
        <h2>ğŸ“ Code CorrigÃ©</h2>
        <div class="code-block">
window.getStaticAIResponse = function(message) {
    const msg = message.toLowerCase();
    const language = window.detectMessageLanguage(message);
    
    // âœ… CORRECTION: DÃ©finir responses localement
    const responses = {
        'fr': { /* ... rÃ©ponses franÃ§aises ... */ },
        'en': { /* ... rÃ©ponses anglaises ... */ },
        'ar': { /* ... rÃ©ponses arabes ... */ }
    };
    
    const lang = responses[language] || responses['en'];
    // ... reste de la logique
};
        </div>
    </div>

    <div class="test-result success">
        <h2>ğŸ¯ Validation</h2>
        <p>âœ… Variable <code>responses</code> dÃ©finie localement dans la fonction</p>
        <p>âœ… Aucune rÃ©fÃ©rence Ã  des variables globales inexistantes</p>
        <p>âœ… Support multilingue maintenu (FR/EN/AR)</p>
        <p>âœ… Logique de dÃ©tection des intentions prÃ©servÃ©e</p>
    </div>
</body>
</html>